2007-08-18  Carl Fredrik Hammar  <hammy.lite@gmail.com>

	* hub.c (channel_alloc_hub): Initialize `lock'.
	(channel_free_hub): Clear `lock'.

	* channel.c (channel_alloc): Zero `user_hook'.
	* channel.c (channel_flush): New function `channel_flush'.

	* channel.h: Include `cthreads.h'.
	(struct channel): New field `class_hook'.
	(struct channel): Add comments for hooks.
	(struct channel_hub): New field `lock'.
	(struct channel_hub): Fixed comment for `hook'.
	(struct channel_class): New method `flush'.
	(CHANNEL_NO_FILEIO): New flag.
	(CHANNEL_ENFORCED): New flag.
	(CHANNEL_GENERIC_FLAGS): Add `CHANNEL_NO_FILEIO' and
	`CHANNEL_ENFORCED'.
	(channel_flush): New function `channel_flush'.

2007-08-16  Carl Fredrik Hammar  <hammy.lite@gmail.com>

	* tests/test-1.c (triv_fifo_open): New function.
	(triv_fifo_cleanup): Rename to triv_fifo_close.
	(triv_fifo_create): Remove.
	(triv_fifo_create_hub) New function.
	(triv_fifo_read): Use class_hook instead of hook.
	(triv_fifo_write): Likewise.
	(main): Create triv_fifo hub.
	(main): Open triv_fifo channel.
	(main): Close triv_fifo channel.
	(triv_fifo_class): Set name.
	(triv_fifo_class): Set open and close methods.

	* Makefile (SRCS): Add hub.c

	* hub.c: New file.

	* channel.c (channel_create): Rename to channel_alloc.
	(channel_alloc): Remove class parameter.
	(channel_alloc): Add hub parameter.
	(channel_alloc): Use class_hook instead of hook.
	(channel_free): Don't call cleanup method.
	(channel_open): New function.
	(channel_close): New function.
	(channel_set_flags): Get class through hub.
	(channel_clear_flags): Likewise.
	(channel_read): Likewise.
	(channel_write): Likewise.

	* channel.h: Merge channel and channel_class page.
	: Merge channel function pages into single page.
	(struct channel): Remove field class.
	(struct channel): New field hub.
	(struct channel): Rename hook to class_hook.
	(struct channel_hub): New struct.
	(struct channel_class): Rename method cleanup to close.
	(struct channel_class): Fix close comment.
	(struct channel_class): New methods open, close, set_hub_flags,
	clear_hub_flags, clear_hub.
	(channel_create): Rename to channel_alloc.
	(channel_alloc): Remove class parameter.
	(channel_alloc): Add hub parameter.
	(channel_free): Fix comment.
	(channel_open, channel_close): New functions.
	(channel_alloc_hub, channel_free_hub): New functions.
	(channel_set_hub_flags, channel_clear_hub_flags): Likewise.

2007-08-07  Carl Fredrik Hammar  <hammy.lite@gmail.com>

	* channel.c (channel_create): Initialize hook.
	(channel_create): Fix comment.

	* channel.h (channel_create): Fix comment.


2007-07-18  Carl Fredrik Hammar  <hammy.lite@gmail.com>

	* channel.c (channel_create channel_free): Improve comments.
	(channel_set_flags, channel_clear_flags): Improve comments.
	(channel_read, channel_write): Improve comments.
	(channel_read, channel_write): Swap place in file.
	(channel_read): Check if channel is write-only.
	(channel_write): Return EPERM if channel is read-only.

	* channel.h: Remove inacurate inductory flag comment.
	(CHANNEL_IMMUTABLE_FLAGS, CHANNEL_INACTIVE): Remove.
	(CHANNEL_INNOCUOUS): Remove.
	(CHANNEL_READONLY, CHANNEL_WRITEONLY): Bump down value.
	(CHANNEL_HARD_READONLY, CHANNEL_HARD_WRITEONLY): Bump down value.
	(CHANNEL_BACKEND_SPEC_BASE): Bump down value.
	(CHANNEL_BACKEND_FLAGS): Add CHANNEL_HARD_WRITEONLY.  Remove
	CHANNEL_INACTIVE.
	(struct channel_class): Inline type of read and write.  Improve
	comments of read, write, set_flags, clear_flags and cleanup.
	(channel_read_meth_t, channel_write_meth_t): Remove.
	(channel_create channel_free): Improve comments.
	(channel_set_flags, channel_clear_flags): Improve comments.
	(channel_read, channel_write): Improve comments.
	(channel_read, channel_write): Swap place in file.

2007-06-28  Carl Fredrik Hammar  <hammy.lite@gmail.com>

	* tests/Makefile: New file.  Based on libpthread/tests/Makefile.
	* tests/test-1.c: New file.
	* channel.h: New file.  Based on libstore/store.h.
	* channel.c: New file.  Based on libstore/make.c, libstore/flags.c
	and libstore/rdwr.c.
	* Makefile: New file.
